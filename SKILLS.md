# Agentic Wallet Skills

> **For AI agents and orchestration systems.** This file defines the complete interface for interacting with the Agentic Wallet — including intent schemas, CLI commands, active policies, and error handling.

Agents do not directly sign transactions. Instead, they emit structured **Intents** that are validated, policy-checked, and executed through a secure pipeline. This document is the single source of truth for how to construct and submit those intents.

---

## 1. Execution Interface (CLI)

### Submit an Intent

```bash
# From a JSON file:
npm run intent-runner -- --file <path-to-json>

# Inline JSON:
npm run intent-runner -- --intent '<json-string>'
```

**Auto-injected fields:** The CLI automatically generates `id` (UUID), `chain` (`"solana"`), and `createdAt` (ISO-8601 timestamp) if omitted. You only need to provide the intent-specific fields.

### Wallet Management

```bash
# List all wallets (public keys, labels, balances):
npm run wallets -- list

# Create a new wallet:
npm run wallets -- create --label <name>
```

The `fromWalletId` used in intents is the wallet's **base58 public key** (not a UUID). Use `npm run wallets -- list` to discover existing wallet IDs.

---

## 2. Intent Schemas

All intents share a common base and are validated against strict [Zod](https://zod.dev) schemas. The discriminated union uses the `type` field.

### Base Fields (shared by all intents)

| Field | Type | Required | Description |
|---|---|---|---|
| `type` | `string` | ✅ | Intent discriminator (see types below) |
| `fromWalletId` | `string` | ✅ | Sender's base58 public key |
| `reasoning` | `string` | Optional | Human-readable explanation for audit trail |
| `id` | `string (UUID)` | Auto | Auto-generated by CLI if omitted |
| `chain` | `string` | Auto | Auto-generated as `"solana"` if omitted |
| `createdAt` | `string (ISO-8601)` | Auto | Auto-generated if omitted |

### `transfer`

Transfers native SOL or SPL tokens to a recipient.

```json
{
  "type": "transfer",
  "fromWalletId": "4Usb5gsxg36LaxaWWH4NmJ5UwEoMpf8WbYzhWhrvWpXw",
  "to": "3ffYfeB4toVUhgEPKgEeSRqFbff5EXHHqNvxmW5p2r2G",
  "amount": "1000000000",
  "reasoning": "Paying for API services rendered"
}
```

| Field | Type | Required | Description |
|---|---|---|---|
| `to` | `string` | ✅ | Recipient base58 public key |
| `amount` | `string` → `BigInt` | ✅ | Amount in smallest unit (lamports). Pass as string; CLI converts to BigInt |
| `tokenMint` | `string` | Optional | SPL token mint address. Omit for native SOL transfers |

### `swap`

Swaps tokens via the Orca Whirlpools protocol.

```json
{
  "type": "swap",
  "fromWalletId": "DEUoqik3sTHqHtPjVdnCFN13eVRVZe6gYPDEgx8GvY54",
  "poolAddress": "3KBZiL2g8C7tiJ32hTv5v3KM7aK9htpqTw4cTXz1HvPt",
  "tokenInMint": "So11111111111111111111111111111111111111112",
  "tokenOutMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
  "amountIn": "100000",
  "minAmountOut": "100000",
  "reasoning": "Swapping WSOL to USDC to preserve capital"
}
```

| Field | Type | Required | Description |
|---|---|---|---|
| `poolAddress` | `string` | ✅ | Orca Whirlpool or AMM pool address |
| `tokenInMint` | `string` | ✅ | Mint address of the input token |
| `tokenOutMint` | `string` | ✅ | Mint address of the output token |
| `amountIn` | `string` → `BigInt` | ✅ | Amount of input token (smallest unit) |
| `minAmountOut` | `string` → `BigInt` | ✅ | Minimum acceptable output amount (slippage protection) |

### `create_mint`

Creates a new SPL token mint on Solana.

```json
{
  "type": "create_mint",
  "fromWalletId": "4Usb5gsxg36LaxaWWH4NmJ5UwEoMpf8WbYzhWhrvWpXw",
  "decimals": 9,
  "reasoning": "Creating a new ecosystem token"
}
```

| Field | Type | Required | Description |
|---|---|---|---|
| `decimals` | `number (0–9)` | ✅ | Number of decimal places for the token |
| `mintAuthority` | `string` | Optional | Public key allowed to mint tokens. Defaults to sender |
| `freezeAuthority` | `string` | Optional | Public key allowed to freeze accounts. Defaults to sender |

### `mint_token`

Mints an existing SPL token to a target wallet.

```json
{
  "type": "mint_token",
  "fromWalletId": "4Usb5gsxg36LaxaWWH4NmJ5UwEoMpf8WbYzhWhrvWpXw",
  "mint": "TokenMintBase58Address",
  "to": "3ffYfeB4toVUhgEPKgEeSRqFbff5EXHHqNvxmW5p2r2G",
  "amount": "1000000000",
  "reasoning": "Airdropping tokens to user"
}
```

| Field | Type | Required | Description |
|---|---|---|---|
| `mint` | `string` | ✅ | SPL token mint address |
| `to` | `string` | ✅ | Destination wallet base58 public key |
| `amount` | `string` → `BigInt` | ✅ | Amount to mint in smallest units |

---

## 3. Active Policies

Every intent is evaluated by the `PolicyEngine` **before** any transaction is built. If any policy denies the intent, execution is aborted immediately.

| Policy | What It Checks | Denial Behavior |
|---|---|---|
| **SpendingLimitPolicy** | Total spending per agent within a sliding time window | Denies if projected spend exceeds `MAX_SPEND_LAMPORTS` |
| **RateLimitPolicy** | Transaction frequency per agent | Denies if agent exceeds `MAX_TX_PER_MINUTE` transactions in a 60-second window |
| **ProgramWhitelistPolicy** | Target program IDs against an allowlist | Denies if the transaction targets an unapproved program |

> **Recovery:** On denial, the CLI outputs a structured error with the policy ID and reason. Adjust the intent (e.g., lower the amount or wait for the rate window to reset) and resubmit.

---

## 4. Execution Pipeline

Every intent passes through these stages in order:

```
Intent JSON → Validation → PolicyEngine → Build Tx → Sign → Send → Confirm
```

| Stage | What Happens | Error Code on Failure |
|---|---|---|
| **Validation** | Zod schema parsing | `VALIDATION_ERROR` |
| **Policy** | All registered policies evaluate the intent | `POLICY_VIOLATION` |
| **Build** | Protocol adapter constructs the raw transaction | `PIPELINE_ERROR` |
| **Sign** | Signer retrieves key from KeyStore, signs, discards key | `PIPELINE_ERROR` |
| **Send** | Signed transaction sent to the Solana RPC | `PIPELINE_ERROR` |
| **Confirm** | Transaction confirmation is awaited | `CONFIRMATION_FAILED` |

---

## 5. Response Format

### Success

```json
{
  "status": "success",
  "txHash": "4x...",
  "chain": "solana",
  "confirmedAt": "2026-02-25T09:00:00.000Z",
  "meta": {
    "elapsedMs": 1250,
    "explorerUrl": "https://explorer.solana.com/tx/4x...?cluster=devnet"
  }
}
```

### Failure

```json
{
  "status": "failure",
  "errorCode": "POLICY_VIOLATION",
  "errorMessage": "Spending limit exceeded: projected 5000000000 > limit 1000000000 lamports in current window",
  "failedAt": "policy"
}
```

**Error codes:** `VALIDATION_ERROR` | `POLICY_VIOLATION` | `CONFIRMATION_FAILED` | `PIPELINE_ERROR`

**Pipeline stages:** `validation` | `policy` | `build` | `sign` | `send` | `confirm`

---

## 6. Agent Context (Simulation Mode)

When running inside a simulation, agents receive an `AgentContext` each tick:

| Field | Type | Description |
|---|---|---|
| `tick` | `number` | Current execution round |
| `balance` | `bigint` | Current native SOL balance (lamports) |
| `knownWallets` | `string[]` | Public keys of all visible participants |
| `meta` | `Record<string, unknown>` | Arbitrary metadata. Read `meta.lastMintAddress` to discover newly created tokens from peers |
